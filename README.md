# library_catalog_management

файл main.py

Создается экземпляр FastAPI, который будет обрабатывать HTTP-запросы и управлять маршрутизацией.
Конфигурация JWT:

Настраивается секретный ключ и алгоритм для подписи токенов, а также устанавливается время жизни токена.
MailSender:

Инициализируется класс для отправки электронных писем, позволяя отправлять уведомления пользователям.
Модели данных
User, UserInDB, Reader, Book, BorrowedBook:
Каждая модель представляет собой структуру данных для хранения информации о пользователях, читателях, книгах и выданных книгах. Используется Pydantic для валидации данных.
Временные "базы данных"
Используются простые структуры данных (словарь и списки) для хранения информации о пользователях, читателях, книгах и выданных книгах. Это позволяет легко управлять данными в памяти.
Хеширование паролей
Пароли пользователей хранятся в хешированном виде для повышения безопасности. Используется библиотека passlib для хеширования и проверки паролей.
Функции для работы с паролями и JWT
verify_password: Проверяет, соответствует ли введенный пароль хешу.
get_password_hash: Хеширует пароль перед сохранением.
create_access_token: Генерирует токен доступа с заданными данными и временем жизни.
get_current_user: Извлекает информацию о текущем пользователе из токена, проверяя его валидность.

Эндпоинты
Регистрация пользователя (/register/):

Проверяет, зарегистрирован ли email. Если нет, хеширует пароль и сохраняет информацию о пользователе. Также отправляет приветственное письмо.
Получение токена (/token):
Принимает учетные данные пользователя и проверяет их. Если они верные, генерирует и возвращает токен доступа.
Управление читателями:

Добавление читателя (/readers/): Проверяет уникальность email и добавляет нового читателя в базу.

Получение всех читателей (/readers/): Возвращает список всех зарегистрированных читателей.

Управление книгами:
Добавление книги (/books/): Проверяет уникальность ID книги и добавляет ее в базу.
Получение всех книг (/books/): Возвращает список всех книг.

Выдача и возврат книг:

Выдача книги (/borrow/): Проверяет доступность книги и количество книг, которые может взять читатель. Уменьшает количество доступных копий и добавляет запись о выданной книге. Также отправляет уведомление читателю о выдаче книги.

Возврат книги (/return/): Проверяет, была ли книга выдана, и обновляет статус возврата.
Получение выданных книг (/readers/{reader_id}/borrowed_books/): Возвращает список книг, которые читатель еще не вернул.

Логика взаимодействия
Пользователь регистрируется, и его данные сохраняются в памяти.
После регистрации пользователь может аутентифицироваться, получая токен доступа для защиты последующих запросов.
Читатели и книги управляются через отдельные эндпоинты, которые проверяют данные на уникальность и доступность.
Выдача и возврат книг сопровождаются уведомлениями по электронной почте, что улучшает взаимодействие с пользователем.

файл mail.py

Импорт библиотек: Используются smtplib для отправки почты и email.mime для создания сообщений.

Класс MailSender:
Инициализация: Конструктор принимает параметры SMTP-сервера, порта, имени пользователя и пароля.
Метод send_email: Формирует и отправляет электронное письмо. Принимает адрес получателя, тему и текст сообщения.

Отправка письма:
Устанавливается соединение с SMTP-сервером, используется TLS для безопасности.
Вход в аккаунт с использованием предоставленных учетных данных.
Отправка сообщения.
Обработка ошибок: Если отправка письма не удалась, выбрасывается исключение HTTPException.

requirements.txt (файл с зависимостями проекта)

Запуск проекта командой: uvicorn main:library_catalog_management --reload

файл test_main.py 
Файл с тестами. 
Тест на успешное заимствование книги
Тест на попытку заимствования книги, которой нет в наличии
Тест на попытку заимствования более трех книг
Тест на доступ к защищенному эндпоинту без токена
Тест на доступ к защищенному эндпоинту с токеном

Запуск командой : pytest test_main.py

    





